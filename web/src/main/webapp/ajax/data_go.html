<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>data_go</title>
</head>

<body>
    <h3>예방접종센터 조회</h3>
    <label for="center">조회대상 입력 : <input type="text" name="center" id="center"></label>
    <button id="searchBtn">조회</button>
    <button id="searchAll">전체조회</button>
    <p></p>
    <table border="1">
        <thead>
            <tr>
                <th>시설아이디</th>
                <th>센터명</th>
                <th>시도</th>
                <th>시군구</th>
                <th>센터주소</th>
                <th>센터번호</th>
            </tr>
        </thead>
        <tbody id="list">

        </tbody>
    </table>

    <script>
        // 조회클릭
        document.getElementById('searchBtn').addEventListener('click', searchCenterFnc);

        // 화면초기화
        let gdata;

        // 전체조회
        document.getElementById('searchAll').addEventListener('click', pageLoadCallBack1);

        // ?뒤가 parameter
        let req_url =
        `https://api.odcloud.kr/api/15077586/v1/centers?page=1&perPage=100&returnType=JSON&serviceKey=O%2FLhKCKKGGOnbYMXBN06pZvZamSvvneQMNhYlbTlyqTOgLGwiPC2u8ISOie%2FnQYBPF4OSxidGRMYW5SPg9Gq8w%3D%3D`;
        let xhtp = new XMLHttpRequest();
        xhtp.open('get', req_url);
        xhtp.send();
        xhtp.onload = pageLoadCallBack;
        
        function pageLoadCallBack() {
            let result = JSON.parse(xhtp.responseText);
            
            let tbody = document.getElementById('list');
            
            let data = result.data;
            gdata = data;
            data.forEach(center => {
                tbody.append(makeTr(center));
            })
            
        }
        
        function pageLoadCallBack1() {
            document.querySelectorAll('#list>tr').forEach(tr => tr.remove());
            
            let result = JSON.parse(xhtp.responseText);
            
            let tbody = document.getElementById('list');
            
            let data = result.data;
            gdata = data;
            data.forEach(center => {
                tbody.append(makeTr(center));
            })
            
        }

        function makeTr(center) {
            let tr = document.createElement('tr');
            
            // 보고싶은 항목
            let infos = ['id', 'centerName', 'sido', 'sigungu', 'address', 'phoneNumber'];
            infos.forEach(info => {
                let td = document.createElement('td');
                let txt = document.createTextNode(center[info]);
                td.append(txt);
                tr.append(td);
            })
            return tr;
        }
        
        // 조회클릭 함수
        function searchCenterFnc() {
            let sido = document.getElementById('center').value;
            let tbody = document.getElementById('list');

            document.querySelectorAll('#list>tr').forEach(tr => tr.remove());

            gdata.forEach(center => {
                if (center.sido.startsWith(sido)) {
                    tbody.append(makeTr(center));
                }
            });
        }
        </script>
</body>

</html>